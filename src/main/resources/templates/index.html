<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">!-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css" type="text/css">
   
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <title>VOLONTER</title>
</head>
<body>


  <nav class="navbar navbar-expand-lg navbar-dark bg-success">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      <img src="img/logo.png"width="70" height="50" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#">About Us</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#">Contact Us</a>
        </li>
      </ul>
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add New</button>    
    </div>
  </div>
</nav>

  <tbody id="tableBody"></tbody>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          var currentDate = new Date();
          var postDateElement = document.getElementById('post-date');
          postDateElement.textContent = currentDate.toDateString();
        });

        $(document).ready(function() {
            loadMissionList();
        });

        function loadMissionList() {
            $.ajax({
                url: '/mission',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    renderMissionList(data);
                },
                error: function(xhr, status, error) {
                    console.error(error);
                }
            });
        }


        // Рендеринг списку платежів
        function renderMissionList(data) {
            var paymentTableBody = $('#paymentTableBody');
            paymentTableBody.empty();

            data.forEach(function(payment) {
                var row =
                    '    <div id="wrap">\n' +
                    '      <div class="gay_element">\n' +
                    '          <a href="#myDiv" id="modal-id" uk-toggle>\n' +
                    '              <img id="'+ payment.imageId +'"src="">\n' +
                    '              <div>\n' +
                    '                  <h3 class="xui">' + payment.name + '</h3>\n' +
                    '                  <p>a poshel ti nahooy</p>\n' +
                    '              </div>\n' +
                    '          </a>\n' +
                    '      </div>\n' +
                    '    </div>\n' +
                    '    <div id="myDiv">\n' +
                    '      <div id="myModal" style="overflow: hidden" class="modal">\n' +
                    '          <div style="width: 600px; max-height: 650px; overflow: scroll;margin-top:0;" class="modal-content">\n' +
                    '              <span id="close">&times;</span>\n' +
                    '              <img id="'+ payment.imageId +'2"src="">\n' +
                    '              <div class="mcontent">\n' +
                    '                  <h2>' + payment.name + '</h2>\n' +
                    '                  <p>Description: ' + payment.description + '</p>\n' +
                    '                  <p>Donations: ' + payment.current + '/' + payment.total + '</p>\n' +
                    '                  <div>\n' +
                    '                      <button class="make-donation">make donation</button>\n' +
                    '                  </div>\n' +
                    '                  <spam id="post-date">' + payment.createdOn + '</spam>\n' +
                    '              </div>\n' +
                    '          </div>\n' +
                    '      </div>\n' +
                    '    </div>';

                getImgById(payment.imageId)
                    .then(response => response.blob())
                    .then(blob => {
                        const imageURL = URL.createObjectURL(blob);
                        // Set the image source for the first <img> tag
                        document.getElementById(payment.imageId).src = imageURL;
                        // Set the image source for the second <img> tag
                        document.getElementById(payment.imageId + '2').src = imageURL;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Handle the error if needed
                    });

                paymentTableBody.append(row);
            });
        }

        function getImgById(id) {
            return fetch(`/upload/image/${id}`)
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        throw new Error('Failed to retrieve image.');
                    }
                });
        }


        // Get the modal element
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("modal-id");

        // Get the <span> element that closes the modal
        var span = document.getElementById("close");

        // When the user clicks the button, open the modal
        btn.onclick = function () {
          modal.style.display = "block";
        };

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
          modal.style.display = "none";
        };

        // When the user clicks anywhere outside of the modal, close it
        // window.onclick = function (event) {
        //   if (event.target == modal) {
        //     modal.style.display = "none";
        //   }
        // };
    </script>


</body>
</html>